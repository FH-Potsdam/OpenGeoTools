---
layout: default
---
<div class="container" id="intro">
	<div class="row">
		<div class="col hidden-xs col-sm-2 col-md-3"></div>
		<div class="col col-xs-12 col-sm-8 col-md-6">
			<h1>Open Geo Tools</h1>
			<p>
				An open, in-progress, and extendable collection of tools and libraries in the area of geo-spatial data analysis and visualization.
			</p>

			<p>
				This is the online companion to our abstract at the <a href="http://www.geoinfo.dgfk.net/">64<sup>th</sup> German Cartography conference</a>.
				Meier, S., Heidmann, F., Nagel, T. <em>Open Geo Tools — A State of the Art Report The democratization of geo-tools and data continues</em>. 2016
			</p>
		</div>
		<div class="col hidden-xs col-sm-2 col-md-3"></div>
	</div>
</div>
<div class="container">
	<div class="row">
		<div class="col col-xs-12">
			<div id="matrix"></div>
		</div>
	</div>
</div>
{% include js-files.html %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script type="text/javascript">
	var tools = [], structure = {}, master = false;
	var load = 0;

	var valuesMap = {
			"0": {"label": "No", "icon": "✗", "image": "no.png"},
			"1": {"label": "Yes", "icon": "✓", "image": "yes.png"},
			"2": {"label": "Partial", "icon": "(✓)", "image": "partial.png"},
			"3": {"label": "N/A", "icon": "n/a", "image": "notavailable.png"}
		};

	function htmlExists(json) {
		var r = false;
		var j = fileName(json);
		for (var i in htmls) {
			html = fileName(htmls[i]);
			if (html === j) {
				r = true;
			}
		}
		return r;
	}

	function fileName(file) {
		return (((file.split("/"))[((file.split("/")).length-1)]).split("."))[0];
	}

	function loadJson() {
		if (jsons[load][0].indexOf("template.json")<0) {
			d3.json("./"+jsons[load][0], function(data) {
				if (data.id === "master") { master = tools.length; }
				tools.push({
					file: jsons[load][0],
					name: fileName(jsons[load][0]),
					date: new Date(jsons[load][1]),
					data: data,
					html: htmlExists(jsons[load][0])
				});
				load++;
				if (load < jsons.length) {
					setTimeout(loadJson, 1);
				} else {
					init();
				}
			});
		} else {
			load++;
			if (load < jsons.length) {
				setTimeout(loadJson, 1);
			} else {
				init();
			}
		}
	}

	function countProperties(obj) {
		var c = 0;
		for (var prop in obj) {
			c++;
		}
		return c;
	}

	function init() {
		for (var i in tools) {
			for (var key1 in tools[i].data.features) {
				if (key1 !== "description" && key1 !== "label") {
					if (!(key1 in structure)) {
						structure[key1] = {};
					}
					for (var key2 in tools[i].data.features[key1]) {
						if (key2 !== "value" && key2 !== "comment" && key2 !== "description" && key2 !== "label") {
							if (!(key2 in structure[key1])) {
								structure[key1][key2] = {};
							}
							for (var key3 in tools[i].data.features[key1][key2]) {
								if (key3 !== "value" && key3 !== "comment" && key3 !== "description" && key3 !== "label") {
									if (!(key3 in structure[key1][key2])) {
										structure[key1][key2][key3] = {};
									}
								}
							}
						}
					}
				}
			}
		}

		var flat = [];
		for (var key1 in structure) {
			for (var key2 in structure[key1]) {
				if (countProperties(structure[key1][key2]) === 0) {
					flat.push([key1,key2,false]);
				}
				for (var key3 in structure[key1][key2]) {
					flat.push([key1,key2,key3]);
				}
			}
		}

		function ignoreMaster(d) {
			return (d.file.indexOf("master.json") < 0);
		}

		var table = d3.select('#matrix').append("table");
		var thead = table.append("thead").append("tr");
			thead.append("th");
			thead.append("th");
			thead.append("th");
			thead.selectAll("th.head").data(tools.filter(ignoreMaster)).enter().append("th")
				.attr("class","head")
				.html(function(d){ return ((d.html)?"<a href=\"./tools/"+d.name+".html\">":"")+d.data.name+((d.html)?"</a>":""); });

		var tbody = table.append("tbody");

		var topCategoryIndex = 0;

		var keys = [false,false,false];
		for(var i in flat){
			var tkeys = [];
			for(var j in flat[i]){
				if(flat[i][j] === keys[j]){
					tkeys[j] = "";
				}else{
					tkeys[j] = keys[j] = flat[i][j];
				}
			}

			// var tr = tbody.append("tr");
			// if (i == 0) {
			// 	tr.attr("class", "topCategoryLevel");
			// }
			// tr.attr("class", "row-" + i);
			var tr = null;

			for (var j in tkeys) {
				var label = (tkeys[j]!==false)?tkeys[j]:"",
					descr = "";

				if(tkeys[j]!==false && tkeys[j]!==""){
					switch(j){
						case "0":
							descr = ("description" in tools[master].data.features[keys[0]])?tools[master].data.features[keys[0]].description:"";
							label = ("label" in tools[master].data.features[keys[0]])?tools[master].data.features[keys[0]].label:label;
						break;
						case "1":
							descr = ("description" in tools[master].data.features[keys[0]][keys[1]])?tools[master].data.features[keys[0]][keys[1]].description:"";
							label = ("label" in tools[master].data.features[keys[0]][keys[1]])?tools[master].data.features[keys[0]][keys[1]].label:label;
						break;
						case "2":
							descr = ("description" in tools[master].data.features[keys[0]][keys[1]][keys[2]])?tools[master].data.features[keys[0]][keys[1]][keys[2]].description:"";
							label = ("label" in tools[master].data.features[keys[0]][keys[1]][keys[2]])?tools[master].data.features[keys[0]][keys[1]][keys[2]].label:label;
						break;
					}
				}

				if (j == 0) {
					tr = tbody.append("tr");
					tr.attr("class", "topCategory-" + topCategoryIndex);

					// Add spacer between top-level category rows
					if (label !== "") {
						tr.attr("class", "categorySpacer");
						tr.append("th");
						tr.append("td");
						tr = tbody.append("tr");
						topCategoryIndex++;
						tr.attr("class", "topCategory-" + topCategoryIndex);
					}
				}

				tr.append("th")
					.attr("title", descr)
					.text(label);
			}

			for(var j in tools){
				if(tools[j].file.indexOf("master.json")<0){
					var t = "-";
					if(flat[i][2]===false){
						if((keys[0] in tools[j].data.features) && (keys[1] in tools[j].data.features[keys[0]]) && ("value" in tools[j].data.features[keys[0]][keys[1]])){
							t = tools[j].data.features[keys[0]][keys[1]].value;
						}
					}else{
						if((keys[0] in tools[j].data.features) && (keys[1] in tools[j].data.features[keys[0]]) && (keys[2] in tools[j].data.features[keys[0]][keys[1]]) && ("value" in tools[j].data.features[keys[0]][keys[1]][keys[2]])){
							t = tools[j].data.features[keys[0]][keys[1]][keys[2]].value;
						}
					}


					var label = "-";
					var icon = "-";
					if (t in valuesMap) {
							var valueObject = valuesMap[t];
							label = valueObject.label;
							icon = valueObject.icon;
					}
					tr.append("td").text(icon);
				}
			}
		}


	}

	loadJson();

</script>
